<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>R4N</title>
    <link rel="icon" type="image/png" href="assets/icon.png">

    <style>
        :root {
            --bg: #fefefe;
            --fg: #111111;
            --muted: rgba(17,17,17,0.65);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--bg);
            color: var(--fg);
            min-height: 100vh;
            overflow: hidden;
            position: relative;
            font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
            font-size: 13px;
            font-weight: 400;
            letter-spacing: 0.2px;
        }

        /* Logo smaller + closer to top */
        .logo {
            width: 100%;
            display: flex;
            justify-content: center;
            padding-top: 0px;
            margin-top: -6px;
            position: relative;
            z-index: 5;
        }

            .logo a {
                display: inline-flex;
                text-decoration: none;
            }

            .logo img {
                width: 136px;
                height: 136px;
                object-fit: contain;
                display: block;
            }

        /* BACK button */
        .back {
            position: fixed;
            left: 70px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 20;
            text-decoration: none;
            color: var(--muted);
            font-size: 13px;
            letter-spacing: 2px;
            font-weight: 500;
            padding: 10px 12px;
            border-radius: 0;
            background: transparent;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            transition: color 0.15s ease, transform 0.15s ease;
        }

            .back:hover {
                color: rgba(17,17,17,0.90);
                transform: translateY(-50%) translateX(-1px);
            }

        /* Draggable projects (overlap allowed) */
        .drag {
            position: absolute;
            z-index: 10;
            user-select: none;
            touch-action: none;
            cursor: grab;
            text-align: center;
            padding: 10px;
            border-radius: 0;
            /* FIX for flicker: hide until positioned */
            visibility: hidden;
        }

            .drag.ready {
                visibility: visible;
            }

            .drag:active {
                cursor: grabbing;
            }

            .drag.is-dragging {
                outline: 2px dotted rgba(17,17,17,0.55);
                outline-offset: 4px;
                border-radius: 0;
            }

            .drag img {
                width: 210px;
                height: 210px;
                object-fit: contain;
                display: block;
                margin: 0 auto;
                filter: drop-shadow(0 6px 18px rgba(0,0,0,0.16));
                opacity: 0.94;
                transition: transform 0.15s ease, opacity 0.15s ease;
            }

            .drag:hover img {
                transform: scale(1.02);
                opacity: 1;
            }

        .label {
            margin-top: 10px;
            text-transform: uppercase;
            color: var(--muted);
            letter-spacing: 1.8px;
        }

        /* Socials footer */
        .socials {
            position: fixed;
            left: 50%;
            bottom: 36px;
            transform: translateX(-50%);
            z-index: 50;
            color: var(--muted);
            font-size: 12px;
            letter-spacing: 0.4px;
            user-select: none;
            white-space: nowrap;
        }

            .socials a {
                color: inherit;
                text-decoration: none;
            }

                .socials a:hover {
                    color: rgba(17,17,17,0.9);
                }

        a {
            color: inherit;
            -webkit-tap-highlight-color: transparent;
        }
    </style>
</head>

<body>
    <a class="back" id="backBlock" href="index.html" aria-label="Back to home">&lt; - BACK</a>

    <div class="logo" id="logoBlock">
        <a href="index.html" aria-label="Home">
            <img src="assets/logo.png" alt="Logo">
        </a>
    </div>

    <!-- Project 1 -->
    <a href="https://open.spotify.com/album/2pHA2yqsAC9uum0lE1kyV5?si=qG4s6773SyW9N3YUAzow8w"
       target="_blank" rel="noopener"
       id="p1Link" aria-label="TI KNIVER I HJERTET">
        <div class="drag" id="p1Btn" data-store-key="projects:p1">
            <img src="assets/project1.png" alt="Project 1">
            <div class="label">TI KNIVER I HJERTET</div>
        </div>
    </a>

    <!-- Project 2 -->
    <a href="https://open.spotify.com/album/4hGT9RG7lSGz9MtX85Jpta?si=MaSikX3wTL-xhOIH3aTsnQ"
       target="_blank" rel="noopener"
       id="p2Link" aria-label="FLAWLESS FASADE">
        <div class="drag" id="p2Btn" data-store-key="projects:p2">
            <img src="assets/project2.png" alt="Project 2">
            <div class="label">FLAWLESS FASADE</div>
        </div>
    </a>

    <!-- Socials -->
    <div class="socials" aria-label="Social links">
        <a href="https://www.instagram.com/r4n.wav/" target="_blank" rel="noopener">instagram</a>
        &nbsp;/&nbsp;
        <a href="https://open.spotify.com/artist/2RhtCG7SVNhfYCBHkpFvFr" target="_blank" rel="noopener">spotify</a>
        &nbsp;/&nbsp;
        <a href="mailto:r4nmusic@outlook.com">contact</a>
    </div>

    <script>
        // ---------- Z-INDEX layering: last selected always on top ----------
        let zCounter = 60;
        function bringToFront(el) {
            zCounter += 1;
            el.style.zIndex = String(zCounter);
        }

        function getStoredPos(key) {
            try { return JSON.parse(localStorage.getItem(key) || "null"); }
            catch { return null; }
        }
        function setStoredPos(key, pos) {
            localStorage.setItem(key, JSON.stringify(pos));
        }
        function setElPos(el, x, y) {
            el.style.left = `${x}px`;
            el.style.top = `${y}px`;
        }
        function clamp(v, min, max) { return Math.max(min, Math.min(max, v)); }

        // clamp only on release/resize
        function clampToViewport(el, x, y) {
            const vw = window.innerWidth;
            const vh = window.innerHeight;
            const w = el.offsetWidth;
            const h = el.offsetHeight;
            return { x: clamp(x, 0, vw - w), y: clamp(y, 0, vh - h) };
        }

        function makeDraggable(el, linkEl, defaults) {
            const storeKey = el.dataset.storeKey;

            let dragging = false;
            let startX = 0, startY = 0;
            let offsetX = 0, offsetY = 0;
            let movedEnough = false;
            const MOVE_THRESHOLD = 6;

            function pointerDown(e) {
                dragging = true;
                movedEnough = false;

                bringToFront(el);

                el.setPointerCapture?.(e.pointerId);

                const rect = el.getBoundingClientRect();
                startX = e.clientX; startY = e.clientY;
                offsetX = e.clientX - rect.left;
                offsetY = e.clientY - rect.top;

                el.classList.add("is-dragging");
                el.style.cursor = "grabbing";
                e.preventDefault();
            }

            function pointerMove(e) {
                if (!dragging) return;

                const dx = e.clientX - startX;
                const dy = e.clientY - startY;
                if (!movedEnough && Math.hypot(dx, dy) > MOVE_THRESHOLD) movedEnough = true;

                // allow out-of-bounds while dragging
                const x = e.clientX - offsetX;
                const y = e.clientY - offsetY;
                setElPos(el, x, y);

                if (movedEnough) linkEl.dataset.dragging = "1";
                e.preventDefault();
            }

            function pointerUp(e) {
                if (!dragging) return;
                dragging = false;

                el.classList.remove("is-dragging");
                el.style.cursor = "grab";

                // snap into viewport on release
                const left = parseFloat(el.style.left || "0");
                const top = parseFloat(el.style.top || "0");
                const snapped = clampToViewport(el, left, top);

                setElPos(el, snapped.x, snapped.y);
                setStoredPos(storeKey, snapped);

                setTimeout(() => { delete linkEl.dataset.dragging; }, 0);
                e.preventDefault();
            }

            linkEl.addEventListener("click", (e) => {
                if (linkEl.dataset.dragging === "1") {
                    e.preventDefault();
                    e.stopPropagation();
                }
            });

            el.addEventListener("pointerdown", pointerDown);
            window.addEventListener("pointermove", pointerMove, { passive: false });
            window.addEventListener("pointerup", pointerUp, { passive: false });

            function initPos() {
                const saved = getStoredPos(storeKey);
                const raw = saved ?? defaults;
                const snapped = clampToViewport(el, raw.x, raw.y);

                setElPos(el, snapped.x, snapped.y);
                setStoredPos(storeKey, snapped);

                bringToFront(el);
                el.classList.add("ready"); // show only after positioned
            }

            document.addEventListener("DOMContentLoaded", initPos);

            window.addEventListener("resize", () => {
                const left = parseFloat(el.style.left || "0");
                const top = parseFloat(el.style.top || "0");
                const snapped = clampToViewport(el, left, top);
                setElPos(el, snapped.x, snapped.y);
                setStoredPos(storeKey, snapped);
            });
        }

        const p1Btn = document.getElementById("p1Btn");
        const p2Btn = document.getElementById("p2Btn");

        makeDraggable(p1Btn, document.getElementById("p1Link"), {
            x: Math.max(40, (window.innerWidth * 0.30) - (p1Btn.offsetWidth / 2)),
            y: Math.max(160, (window.innerHeight * 0.55) - (p1Btn.offsetHeight / 2))
        });

        makeDraggable(p2Btn, document.getElementById("p2Link"), {
            x: Math.min(window.innerWidth - p2Btn.offsetWidth - 40, (window.innerWidth * 0.62) - (p2Btn.offsetWidth / 2)),
            y: Math.max(160, (window.innerHeight * 0.55) - (p2Btn.offsetHeight / 2))
        });
    </script>
</body>
</html>